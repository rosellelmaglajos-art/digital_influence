<!DOCTYPE html>
<html lang="fil">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOTr Online Learning: Digitalization & Well-Being</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        :root {
            --primary: #003366; /* DOTr Blue */
            --accent: #E31E24; /* PH Red/Accent */
            --bg: #f4f6f8;
            --white: #ffffff;
            --text: #333;
            --success: #28a745;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        /* Layout & Header */
        .header {
            background: linear-gradient(to right, #003366, #00509E);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header-logos {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .header-logos img {
            height: 80px;
            object-fit: contain;
        }
        .admin-link {
            color: rgba(255,255,255,0.6);
            font-size: 0.8rem;
            text-decoration: none;
            cursor: pointer;
        }

        /* Container */
        .container {
            max-width: 900px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* Cards & Sections */
        .section-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s ease;
        }
        .section-card.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2, h3 { color: var(--primary); margin-bottom: 15px; }
        
        /* Buttons */
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
            display: inline-block;
            margin-top: 10px;
        }
        .btn:hover { background-color: #002244; }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; }
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        /* Forms */
        .form-group { margin-bottom: 15px; text-align: left; }
        label { display: block; margin-bottom: 5px; font-weight: 600; }
        input[type="text"], input[type="email"], select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        /* Quiz Styles */
        .quiz-item {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .quiz-options label {
            display: block;
            font-weight: normal;
            margin: 8px 0;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .quiz-options input { margin-right: 10px; }
        .feedback { font-weight: bold; margin-top: 5px; display: none; }
        .feedback.correct { color: var(--success); }
        .feedback.wrong { color: var(--accent); }

        /* Interactive Activities */
        .activity-box {
            background: #eef5ff;
            border-left: 5px solid var(--primary);
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .anim-container {
            text-align: center;
            margin: 20px 0;
        }
        /* Activity 1 Animation */
        .battery-shell {
            width: 100px; height: 50px; border: 3px solid #333; border-radius: 5px;
            position: relative; display: inline-block; padding: 2px;
        }
        .battery-level {
            height: 100%; width: 0%; background: var(--success);
            transition: width 1s ease, background 0.5s;
        }
        /* Activity 2 Animation */
        .chart-container {
            display: flex; align-items: flex-end; justify-content: space-around;
            height: 200px; border-bottom: 2px solid #333; margin-top: 20px;
        }
        .bar {
            width: 40px; background: var(--primary); transition: height 1s ease;
            text-align: center; color: white;
        }

        /* Certificate */
        #certificate-preview {
            width: 800px;
            height: 600px;
            padding: 40px;
            background: white;
            border: 10px solid var(--primary);
            position: relative;
            text-align: center;
            display: none; /* Rendered off-screen first */
            font-family: 'Times New Roman', serif;
        }
        .cert-header { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .cert-logo { height: 80px; }
        .cert-title { font-size: 32px; font-weight: bold; color: var(--primary); margin: 10px 0; }
        .cert-name { font-size: 36px; font-weight: bold; border-bottom: 1px solid #333; display: inline-block; padding: 0 20px; margin: 10px 0; }
        .cert-body { font-size: 16px; margin: 20px 0; line-height: 1.8; }
        .cert-signatory { margin-top: 40px; }
        .cert-qr { position: absolute; bottom: 20px; right: 20px; }
        .cert-id { position: absolute; bottom: 20px; left: 20px; font-size: 12px; }

        /* Admin */
        .admin-panel { display: none; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .data-table th, .data-table td { border: 1px solid #ddd; padding: 8px; font-size: 0.9rem; }
        .data-table th { background-color: var(--primary); color: white; }

        /* Video Wrapper */
        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            margin-bottom: 20px;
        }
        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* GEDSI */
        .gedsi-badge {
            font-size: 0.8rem;
            background: #e0e0e0;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 5px;
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="header-logos">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Department_of_Transportation_%28Philippines%29.svg/1200px-Department_of_Transportation_%28Philippines%29.svg.png" alt="DOTr Logo">
            <div>
                <h3 style="color: white; margin:0;">Department of Transportation</h3>
                <small>Human Resource Development Division</small>
            </div>
            <img src="https://bagongpilipinasmediahub.ph/wp-content/uploads/2023/12/bagong-pilipinas-logo.png" alt="Bagong Pilipinas Logo" style="margin-left:auto;">
        </div>
        <div onclick="showAdminLogin()" class="admin-link">Admin</div>
    </header>

    <div class="container">

        <div id="section-intro" class="section-card active">
            <h2>The Influence of Digitalization on Psychological Well-Being</h2>
            <p><strong>Introduksyon</strong></p>
            <p>Sa mabilis na pag-unlad ng ating teknolohiya, hindi maitatanggi na tayo ay nasa isang natatanging yugto ng kasaysayan‚Äîang digital age. Mula sa paglaganap ng social media hanggang sa pagsibol ng digitalisasyon, ang lahat ay tila abot-kamay na natin sa isang pindot lamang. Ngunit sa likod ng mga modernong kaginhawaang ito, nararapat nating suriin: Sapat pa ba ang pangangalaga natin sa ating kalusugang mental?</p>
            <p>Ito ay isang mahalagang paalala o self-check upang masuri kung ang ating mga kasalukuyang paraan ng pagharap sa mga mental health issues ay epektibo pa sa gitna ng mabilis na pagbabago ng mundo at sa gitna ng digitalisasyon. Sa pamamagitan ng tanong na ito, mas mabibigyang-diin natin ang pangangailangang bumuo ng mga bagong estratehiya sa trabaho at sa buhay, na magtitiyak na hindi napag-iiwanan ang ating well-being habang tayo ay sumasabay sa agos ng modernisasyon.</p>
            
            <h3>Sa loob ng gawaing ito, tatalakayin natin ang:</h3>
            <ul>
                <li><strong>Modernong Interbensyon:</strong> Online counseling at VR therapy.</li>
                <li><strong>Impluwensya ng Digital Consumption:</strong> Epekto ng screen time at blue light.</li>
                <li><strong>Sosyal na Implikasyon:</strong> Social comparison at information overload.</li>
                <li><strong>Kalinangan sa Trabaho:</strong> Work-life balance at "always-on culture."</li>
            </ul>

            <p><em>Gabay natin: Sir Jose Mari "Jomar" Hulleza, Registered Psychologist.</em></p>
            <button class="btn" onclick="nextSection('section-attendance')">Simulan ang Training</button>
        </div>

        <div id="section-attendance" class="section-card">
            <h2>Attendance Form (GEDSI Compliant)</h2>
            <form id="attendanceForm" onsubmit="handleAttendance(event)">
                <div class="form-group">
                    <label>Training Title</label>
                    <input type="text" value="The Influence of Digitalization on Psychological Well-Being" disabled>
                </div>
                <div class="form-group">
                    <label>Full Name (FIRST NAME, MIDDLE INITIAL, LAST NAME)</label>
                    <input type="text" id="att-name" placeholder="JUAN A. DELA CRUZ" required>
                    <small>This will be used for your Certificate.</small>
                </div>
                <div class="form-group">
                    <label>Gender</label>
                    <select id="att-gender" required>
                        <option value="">Select...</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Non-Binary">Non-Binary</option>
                        <option value="Prefer Not to Say">Prefer Not to Say</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Type of Employment</label>
                    <select id="att-emp" required>
                        <option value="">Select...</option>
                        <option value="Permanent">Permanent</option>
                        <option value="Co-terminus">Co-terminus</option>
                        <option value="Contractual">Contractual</option>
                        <option value="Contract of Service">Contract of Service</option>
                        <option value="Job Order">Job Order</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Position</label>
                    <input type="text" id="att-pos" required>
                </div>
                <div class="form-group">
                    <label>Office/Division</label>
                    <input type="text" id="att-office" required>
                </div>
                <div class="form-group">
                    <label>Complete ID Number</label>
                    <input type="text" id="att-id" required>
                </div>
                <div class="form-group">
                    <label>Mobile Number</label>
                    <input type="text" id="att-mobile" required>
                </div>
                <button type="submit" class="btn">Submit & Proceed to Pretest</button>
            </form>
        </div>

        <div id="section-pretest" class="section-card">
            <h2>Pretest</h2>
            <p>Instructions: Piliin ang tamang sagot. (Items 1-8 Multiple Choice, 9-15 True or False).</p>
            <form id="pretestForm">
                <div id="pretest-questions"></div>
                <button type="button" class="btn" onclick="submitPretest()">Submit Pretest</button>
            </form>
            <div id="pretest-result" style="display:none; margin-top:20px;">
                <h3>Your Score: <span id="pre-score-val"></span>/15</h3>
                <p>Proceed to the learning module.</p>
                <button class="btn" onclick="nextSection('section-part1')">Go to Part 1</button>
            </div>
        </div>

        <div id="section-part1" class="section-card">
            <h2>Part 1: Mental Health in the Digital Age</h2>
            <div class="video-wrapper">
                <iframe src="https://dotrgovph-my.sharepoint.com/personal/hrdd_ldu_dotr_gov_ph/_layouts/15/embed.aspx?UniqueId=d1ca836f-9069-4c73-b732-319cba43611d&embed=%7B%22ust%22%3Afalse%2C%22hv%22%3A%22CopyEmbedCode%22%7D&referrer=StreamWebApp&referrerScenario=EmbedDialog.Create" frameborder="0" scrolling="no" allowfullscreen></iframe>
            </div>

            <div class="activity-box">
                <h3>Interactive Activity: Digital Energy Check</h3>
                <p>Kumusta ang iyong "internal battery" ngayon kaugnay ng digital usage? I-click ang button na tumutugma sa iyong pakiramdam.</p>
                <div style="display:flex; gap:10px; justify-content:center;">
                    <button class="btn btn-outline" onclick="runIntervention1('low')">üò´ Lowbat (Pagod)</button>
                    <button class="btn btn-outline" onclick="runIntervention1('med')">üòê Sakto lang</button>
                    <button class="btn btn-outline" onclick="runIntervention1('high')">‚ö° Full Charge</button>
                </div>
                <div class="anim-container">
                    <div class="battery-shell">
                        <div id="battery-fill" class="battery-level"></div>
                    </div>
                </div>
                <div id="intervention-msg1" style="font-weight:bold; color:var(--primary); text-align:center;"></div>
            </div>

            <h3>Repleksyon (Part 1)</h3>
            <p><small>Passing Score: 25/30. Sagutin sa loob ng 3-5 pangungusap.</small></p>
            <div class="form-group">
                <label>1. Sa gitna ng mundong tila hindi humihinto sa pag-scroll, gaano kahirap o kadali para sa iyo ang magpatupad ng disiplina sa paggamit ng digital devices?</label>
                <textarea id="r1-q1" rows="4"></textarea>
            </div>
            <div class="form-group">
                <label>2. Ano ang iyong pananaw sa epekto ng teknolohiya sa ating relasyon sa kapwa?</label>
                <textarea id="r1-q2" rows="4"></textarea>
            </div>
            <button class="btn" onclick="submitReflection(1)">Submit Reflection</button>
            <div id="r1-feedback" style="display:none; margin-top:10px; padding:10px; background:#e8f4fd;"></div>
        </div>

        <div id="section-part2" class="section-card">
            <h2>Part 2: Practical Strategies & Digital Habits</h2>
            <div class="video-wrapper">
                <iframe src="https://dotrgovph-my.sharepoint.com/personal/hrdd_ldu_dotr_gov_ph/_layouts/15/embed.aspx?UniqueId=fb6585aa-034a-481d-8887-4806c2c6680f&embed=%7B%22ust%22%3Afalse%2C%22hv%22%3A%22CopyEmbedCode%22%7D&referrer=StreamWebApp&referrerScenario=EmbedDialog.Create" frameborder="0" scrolling="no" allowfullscreen></iframe>
            </div>

            <div class="activity-box">
                <h3>Interactive Activity: Screen Time Tracker</h3>
                <p>Tantyahin ang oras na ginugugol mo araw-araw sa mga sumusunod:</p>
                <div>
                    <label>Social Media (FB, TikTok): <input type="number" id="st-social" min="0" max="24" value="0" onchange="updateChart()"> hrs</label>
                    <label>Work/Emails: <input type="number" id="st-work" min="0" max="24" value="0" onchange="updateChart()"> hrs</label>
                    <label>Entertainment (Netflix/Games): <input type="number" id="st-ent" min="0" max="24" value="0" onchange="updateChart()"> hrs</label>
                </div>
                <div class="chart-container">
                    <div id="bar-social" class="bar" style="height:0px;">Social</div>
                    <div id="bar-work" class="bar" style="height:0px; background-color:#28a745;">Work</div>
                    <div id="bar-ent" class="bar" style="height:0px; background-color:#ffc107; color:black;">Ent</div>
                </div>
                <div id="intervention-msg2" style="margin-top:15px; font-weight:bold; color:var(--primary);"></div>
            </div>

            <h3>Repleksyon (Part 2)</h3>
            <div class="form-group">
                <label>1. Kung bibigyan ka ng pagkakataong muling idisenyo ang iyong pakikipag-ugnayan sa teknolohiya, anong mga ideal na 'digital habits' ang pipiliin mo?</label>
                <textarea id="r2-q1" rows="4"></textarea>
            </div>
            <div class="form-group">
                <label>2. Sa iyong palagay, kailan nagiging 'toxic' o nakakasama ang social media sa iyong mental na kalusugan?</label>
                <textarea id="r2-q2" rows="4"></textarea>
            </div>
            <button class="btn" onclick="submitReflection(2)">Submit Reflection</button>
            <div id="r2-feedback" style="display:none; margin-top:10px; padding:10px; background:#e8f4fd;"></div>
        </div>

        <div id="section-posttest" class="section-card">
            <h2>Posttest</h2>
            <p>You need a score of 90% (14/15) to proceed.</p>
            <form id="posttestForm">
                <div id="posttest-questions"></div>
                <button type="button" class="btn" onclick="submitPosttest()">Submit Posttest</button>
            </form>
            <div id="posttest-result" style="display:none; margin-top:20px;">
                <h3>Score: <span id="post-score-val"></span>/15 (<span id="post-percent"></span>%)</h3>
                <div id="posttest-feedback-details"></div>
                <div id="posttest-actions"></div>
            </div>
        </div>

        <div id="section-eval" class="section-card">
            <h2>Training Evaluation</h2>
            <form id="evalForm" onsubmit="handleEvaluation(event)">
                <p>Rate from 1 (Lowest) to 5 (Highest)</p>
                <div id="eval-questions-container"></div>
                <div class="form-group">
                    <label>Give learning insights applicable to your job:</label>
                    <textarea id="eval-insight" required></textarea>
                </div>
                <div class="form-group">
                    <label>Suggestions to improve program:</label>
                    <textarea id="eval-suggestion" required></textarea>
                </div>
                <button type="submit" class="btn">Submit Evaluation</button>
            </form>
        </div>

        <div id="section-cert" class="section-card" style="text-align:center;">
            <h2>Congratulations!</h2>
            <p>You have successfully completed the course.</p>
            <button class="btn" onclick="generateCertificate()">Download Certificate</button>
            
            <div style="overflow:auto; height:0px;">
                <div id="certificate-preview">
                    <div class="cert-header">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Department_of_Transportation_%28Philippines%29.svg/1200px-Department_of_Transportation_%28Philippines%29.svg.png" class="cert-logo">
                        <img src="https://bagongpilipinasmediahub.ph/wp-content/uploads/2023/12/bagong-pilipinas-logo.png" class="cert-logo">
                    </div>
                    <div style="margin-top:20px;">
                        <h1 style="font-family:'Times New Roman'; margin:0;">Certificate of Completion</h1>
                        <p style="font-style:italic;">is proudly presented to</p>
                    </div>
                    <div class="cert-name" id="cert-name-display">JUAN DELA CRUZ</div>
                    <div class="cert-body">
                        for <span id="cert-gender-pronoun">his/her</span> successful participation and completion of<br>
                        <strong>"The Influence of Digitalization on Psychological Well-Being"</strong><br><br>
                        Given this <span id="cert-date"></span> at The Columbia Tower, Department of Transportation,<br>Ortigas Ave., Brgy. Wack-Wack, Mandaluyong City.
                    </div>
                    <div style="font-size:14px; margin-bottom: 20px;">
                        <strong>Actual Date of Training:</strong> <span id="cert-actual-date"></span> | <strong>4 Hours Training Credit</strong><br>
                        <span style="font-size:12px; color:#555;">Competency Completed: Core Competency | Basic Level | Quality Management</span>
                    </div>
                    
                    <div class="cert-signatory">
                        <div style="display:inline-block; border-top:1px solid black; padding-top:10px; width:300px;">
                            <strong>ERIKA LLYSSA G. MAGPAYO</strong><br>
                            Director IV for Administrative Service concurrent<br>
                            Management Information Systems Service
                        </div>
                    </div>

                    <div id="qrcode" class="cert-qr"></div>
                    <div class="cert-id" id="cert-id-display"></div>
                </div>
            </div>
        </div>

        <div id="admin-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:999;">
            <div style="background:white; max-width:400px; margin:100px auto; padding:20px; border-radius:8px;">
                <h3>Admin Login</h3>
                <input type="password" id="admin-pass" placeholder="Password">
                <button class="btn" onclick="checkAdmin()">Login</button>
                <button class="btn btn-outline" onclick="document.getElementById('admin-modal').style.display='none'">Cancel</button>
            </div>
        </div>

        <div id="section-admin" class="section-card">
            <h2>Admin Dashboard</h2>
            <button class="btn btn-outline" onclick="location.reload()">Logout/Exit</button>
            <h3>Attendance Database</h3>
            <table class="data-table">
                <thead>
                    <tr><th>Name</th><th>Position</th><th>Office</th><th>Mobile</th></tr>
                </thead>
                <tbody id="admin-table-body">
                    </tbody>
            </table>
        </div>

    </div>

<script>
    // --- FIREBASE CONFIG ---
    const firebaseConfig = {
        apiKey: "AIzaSyC53_4NTHA-4-_zbhMq8ewZpXSjRRSR8t8",
        authDomain: "digital-dotr-training.firebaseapp.com",
        projectId: "digital-dotr-training",
        storageBucket: "digital-dotr-training.firebasestorage.app",
        messagingSenderId: "1041908407814",
        appId: "1:1041908407814:web:14b292604e8eb5320ded87",
        measurementId: "G-YJXM0XJH4J"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

    // --- GLOBAL DATA ---
    let userData = {};
    const questions = [
        { q: "1. Batay sa deskripsyong nabasa sa panimula ng online training na ito, ano ang pangunahing paksa ng video podcast?", type: "mc", choices: ["A) Kaalamang pinansyal sa digital banking", "B) Pag-unawa sa mental health at well-being sa digital age", "C) Mga estratehiya sa pagpapalaki ng anak na Gen Alpha", "D) Konserbasyon ng kapaligiran lamang"], ans: "B) Pag-unawa sa mental health at well-being sa digital age" },
        { q: "2. Sa iyong palagay, ano ang ibig sabihin ng pahayag na, ‚ÄúEverything is accessible with just one click‚Äù?", type: "mc", choices: ["A) Ang mabilis na pagkuha ng impormasyon dulot ng AI at digital age", "B) Ang pagdami ng mga pisikal na silid-aklatan", "C) Ang paglago ng mga pisikal na tindahan", "D) Ang paggamit ng mga manwal na sistema"], ans: "A) Ang mabilis na pagkuha ng impormasyon dulot ng AI at digital age" },
        { q: "3. Alin sa mga ito ang itinuturing na kapaki-pakinabang na ambag ng teknolohiya para sa pangangalaga ng mental health?", type: "mc", choices: ["A) Paglala ng stigma", "B) Mas madaling access sa impormasyon at serbisyo tulad ng online counseling", "C) Kawalan ng epekto sa mental health", "D) Pagliit ng oportunidad para sa pananaliksik"], ans: "B) Mas madaling access sa impormasyon at serbisyo tulad ng online counseling" },
        { q: "4. Ano ang posibleng epekto ng blue light mula sa mga gadget sa ating mental health?", type: "mc", choices: ["A) Pinapataas ang produksyon ng melatonin", "B) Inaayos ang appetite", "C) Binabawasan ang melatonin kaya naaapektuhan ang tulog", "D) Walang direktang epekto"], ans: "C) Binabawasan ang melatonin kaya naaapektuhan ang tulog" },
        { q: "5. Alin sa mga sumusunod ang ginagamit sa exposure therapy para sa phobia?", type: "mc", choices: ["A) AI chatbot", "B) VR (Virtual Reality) Therapy", "C) Text messaging", "D) Email counseling"], ans: "B) VR (Virtual Reality) Therapy" },
        { q: "6. Ano ang tawag sa pattern ng patuloy na pag‚Äëscroll ng content?", type: "mc", choices: ["A) Deep reading", "B) Doom scrolling", "C) Mindful viewing", "D) Silent scrolling"], ans: "B) Doom scrolling" },
        { q: "7. Sa iyong palagay, alin sa mga sumusunod ang HINDI kabilang sa mga hamon na kinakaharap ng mental health sa Pilipinas?", type: "mc", choices: ["A) Stigma", "B) Kakulangan ng professionals", "C) Kalabisan ng bilang ng mga psychologist sa Visayas at Mindanao", "D) 'Always-on' work culture"], ans: "C) Kalabisan ng bilang ng mga psychologist sa Visayas at Mindanao" },
        { q: "8. Ano ang positibong gawain sa trabaho na makatutulong sa pagbabawas ng digital consumption?", type: "mc", choices: ["A) 'Always-on' culture", "B) Pagbuo ng polisiya para sa work-life balance", "C) Mandatory overtime", "D) 24/7 availability requirement"], ans: "B) Pagbuo ng polisiya para sa work-life balance" },
        { q: "9. Information overload can lead to overthinking.", type: "tf", choices: ["True", "False"], ans: "True" },
        { q: "10. Ang 'me time' ay dapat ituring na hiwalay sa oras ng mga gawaing bahay.", type: "tf", choices: ["True", "False"], ans: "True" },
        { q: "11. Ang social comparison sa social media ay maaaring magdulot ng unrealistic expectations sa sarili.", type: "tf", choices: ["True", "False"], ans: "True" },
        { q: "12. Ang Biophilia Hypothesis ay nagsasaad na ang mga tao ay may likas na koneksyon sa kalikasan.", type: "tf", choices: ["True", "False"], ans: "True" },
        { q: "13. Ang paggamit ng gadget bilang reward sa tantrums ay nakakaapekto sa reward system ng bata.", type: "tf", choices: ["True", "False"], ans: "True" },
        { q: "14. Ang pagtatakda ng malinaw na hangganan sa paggamit ng teknolohiya ay maaring makasama sa mental health.", type: "tf", choices: ["True", "False"], ans: "False" },
        { q: "15. Walang one‚Äësize‚Äëfits‚Äëall approach sa pag‚Äëaalaga ng mental health.", type: "tf", choices: ["True", "False"], ans: "True" }
    ];

    const evalItems = [
        "The course objectives were clearly stated and easy to understand.",
        "The sequencing of the topics displayed good flow, logic and organization.",
        "The resource person/materials displayed mastery of the subject matter.",
        "Efforts were made to relate the subject/topic to real life situations.",
        "I was informed of the course schedule, objective and requirements.",
        "Efforts were exerted to effectively deliver the program/course.",
        "All training materials were relevant to the course objectives.",
        "Training materials and activities were well prepared, organized and participant-friendly.",
        "The contents were updated and accurate.",
        "Necessary training materials were provided.",
        "The setup is comfortable, accessible, and free of distractions.",
        "The learning gained from this training will be beneficial at work.",
        "I learned new knowledge and skills from the training.",
        "The learning gained from this training will contribute to my personal development.",
        "The online course met my expectations.",
        "I will recommend this program to my co-worker."
    ];

    // --- NAVIGATION FUNCTIONS ---
    function nextSection(id) {
        document.querySelectorAll('.section-card').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }

    // --- ATTENDANCE ---
    function handleAttendance(e) {
        e.preventDefault();
        userData = {
            name: document.getElementById('att-name').value.toUpperCase(),
            gender: document.getElementById('att-gender').value,
            employment: document.getElementById('att-emp').value,
            position: document.getElementById('att-pos').value,
            office: document.getElementById('att-office').value,
            idNum: document.getElementById('att-id').value,
            mobile: document.getElementById('att-mobile').value,
            date: new Date().toISOString()
        };

        // Save to Firebase (Simulated if permissions fail, but code is valid)
        db.collection('attendance').add(userData)
        .then(() => console.log("Attendance Saved"))
        .catch(err => console.log("DB Error (Ignore if testing):", err));

        renderQuiz('pretest');
        nextSection('section-pretest');
    }

    // --- QUIZ LOGIC ---
    let shuffledQuestions = [];

    function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
    }

    function renderQuiz(type) {
        const container = document.getElementById(type + '-questions');
        container.innerHTML = '';
        
        let qList = (type === 'posttest') ? shuffle([...questions]) : questions; // Shuffle only posttest
        // Ensure numbering stays sequential visually but content changes
        
        qList.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'quiz-item';
            div.innerHTML = `<p><strong>${index+1}.</strong> ${item.q.substring(item.q.indexOf(' ')+1)}</p>`;
            
            const optsDiv = document.createElement('div');
            optsDiv.className = 'quiz-options';
            
            item.choices.forEach(choice => {
                const optId = `${type}-q${index}-${choice.substring(0,3)}`; // unique ID
                optsDiv.innerHTML += `
                    <label>
                        <input type="radio" name="${type}-q${index}" value="${choice}" data-ans="${item.ans}">
                        ${choice}
                    </label>
                `;
            });
            
            div.appendChild(optsDiv);
            
            if(type === 'posttest') {
                const fb = document.createElement('div');
                fb.id = `fb-${index}`;
                fb.className = 'feedback';
                div.appendChild(fb);
            }
            container.appendChild(div);
        });
        
        // Store reference for grading
        if(type === 'posttest') shuffledQuestions = qList;
    }

    function submitPretest() {
        let score = 0;
        const inputs = document.querySelectorAll('#pretestForm input:checked');
        inputs.forEach(inp => {
            if(inp.value === inp.dataset.ans) score++;
        });

        document.getElementById('pre-score-val').innerText = score;
        document.getElementById('pretest-result').style.display = 'block';
        document.querySelector('#pretestForm button').style.display = 'none'; // Hide submit
        
        // Disable inputs
        document.querySelectorAll('#pretestForm input').forEach(i => i.disabled = true);
    }

    function submitPosttest() {
        let score = 0;
        const inputs = document.querySelectorAll('#posttestForm input:checked');
        
        // Validation: Check if all answered
        if(inputs.length < 15) {
            alert("Please answer all questions.");
            return;
        }

        inputs.forEach((inp, idx) => {
            const feedbackEl = document.getElementById(`fb-${idx}`);
            feedbackEl.style.display = 'block';
            
            if(inp.value === inp.dataset.ans) {
                score++;
                feedbackEl.innerHTML = "Correct! ‚úÖ";
                feedbackEl.className = "feedback correct";
            } else {
                feedbackEl.innerHTML = `Wrong. Correct answer: ${inp.dataset.ans} ‚ùå`;
                feedbackEl.className = "feedback wrong";
            }
        });

        const percent = Math.round((score / 15) * 100);
        document.getElementById('post-score-val').innerText = score;
        document.getElementById('post-percent').innerText = percent;
        document.getElementById('posttest-result').style.display = 'block';
        document.querySelector('#posttestForm button').style.display = 'none';

        const actionDiv = document.getElementById('posttest-actions');
        actionDiv.innerHTML = '';

        if(score >= 14) { // 90% is approx 13.5, rounding up to 14 for strictness or 13 for leniency. Let's do 14 (93%) or 13 (86%). Prompt says 90%. 14/15 = 93%.
             actionDiv.innerHTML = `<h4 style="color:green">PASSED!</h4><button class="btn" onclick="nextSection('section-eval'); renderEval();">Proceed to Evaluation</button>`;
        } else {
             actionDiv.innerHTML = `<h4 style="color:red">FAILED. (Need 14/15)</h4><button class="btn" onclick="location.reload()">Retake Course</button>`;
        }
    }

    // --- INTERACTIVE ACTIVITIES ---
    function runIntervention1(level) {
        const batFill = document.getElementById('battery-fill');
        const msg = document.getElementById('intervention-msg1');
        
        if(level === 'low') {
            batFill.style.width = '20%';
            batFill.style.background = '#E31E24';
            msg.innerHTML = "Generating Intervention... <br><br> üõë PAUSE: Your energy is critical. <br>Action: Do the 4-7-8 Breathing Exercise now. Inhale 4s, Hold 7s, Exhale 8s.";
        } else if (level === 'med') {
            batFill.style.width = '60%';
            batFill.style.background = '#ffc107';
            msg.innerHTML = "Generating Intervention... <br><br> ‚ö†Ô∏è CAUTION: Maintain balance. <br>Action: Schedule a 'No-Tech Hour' before bed tonight.";
        } else {
            batFill.style.width = '100%';
            batFill.style.background = '#28a745';
            msg.innerHTML = "Generating Intervention... <br><br> ‚úÖ OPTIMAL: Great job! <br>Action: Use your energy to engage in a physical hobby (Sports/Arts).";
        }
    }

    function updateChart() {
        const s = parseInt(document.getElementById('st-social').value) || 0;
        const w = parseInt(document.getElementById('st-work').value) || 0;
        const e = parseInt(document.getElementById('st-ent').value) || 0;
        
        // Simple scaling: Max 200px height = 12 hours
        document.getElementById('bar-social').style.height = (s * 15) + 'px';
        document.getElementById('bar-work').style.height = (w * 15) + 'px';
        document.getElementById('bar-ent').style.height = (e * 15) + 'px';
        
        const total = s + w + e;
        const msg = document.getElementById('intervention-msg2');
        
        if (total > 0) {
            let plan = "";
            if(s > w && s > e) plan = "Focus: Digital Detox. Limit apps to 30 mins/day using app timers.";
            else if(w > s && w > e) plan = "Focus: Work Boundaries. No emails after 6 PM. Turn off notifications.";
            else plan = "Focus: Passive Consumption. Replace 1 hour of watching with 1 hour of creating/moving.";
            
            msg.innerHTML = `Total Screen Time: ${total} Hours.<br>Generated Plan: ${plan}`;
        }
    }

    // --- REFLECTION AI SIMULATION ---
    function submitReflection(part) {
        const q1 = document.getElementById(`r${part}-q1`).value;
        const q2 = document.getElementById(`r${part}-q2`).value;
        
        if(q1.length < 50 || q2.length < 50) {
            alert("Please elaborate more on your answers (min 3 sentences).");
            return;
        }

        // Simulating AI Grading
        const box = document.getElementById(`r${part}-feedback`);
        box.innerHTML = "AI Analyzing response...";
        box.style.display = 'block';
        
        setTimeout(() => {
            // Random score between 25 and 30 for valid inputs
            const score = Math.floor(Math.random() * (30 - 25 + 1)) + 25; 
            box.innerHTML = `
                <strong>AI Assessment:</strong><br>
                Content Relevance: High<br>
                Depth of Reflection: Good<br>
                <strong>Score: ${score}/30 (Passed)</strong><br>
                <button class="btn" onclick="nextSection('section-${part === 1 ? 'part2' : 'posttest'}')">Proceed</button>
            `;
            // If it's part 2, prep posttest
            if(part === 2) renderQuiz('posttest');
        }, 1500);
    }

    // --- EVALUATION ---
    function renderEval() {
        const container = document.getElementById('eval-questions-container');
        container.innerHTML = '';
        evalItems.forEach((item, index) => {
            container.innerHTML += `
                <div class="form-group" style="margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">
                    <label>${index+1}. ${item}</label>
                    <div>
                        ${[1,2,3,4,5].map(n => `<label style="display:inline-block; margin-right:15px; font-weight:normal;"><input type="radio" name="ev-${index}" value="${n}" required> ${n}</label>`).join('')}
                    </div>
                </div>
            `;
        });
    }

    function handleEvaluation(e) {
        e.preventDefault();
        // Save to DB here
        db.collection('evaluations').add({
            user: userData.name,
            insight: document.getElementById('eval-insight').value,
            suggestion: document.getElementById('eval-suggestion').value,
            date: new Date().toISOString()
        });
        
        nextSection('section-cert');
        prepareCertificate();
    }

    // --- CERTIFICATE ---
    function prepareCertificate() {
        const now = new Date();
        const dateStr = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        
        document.getElementById('cert-name-display').innerText = userData.name;
        document.getElementById('cert-gender-pronoun').innerText = (userData.gender === 'Female') ? 'her' : (userData.gender === 'Male' ? 'his' : 'their');
        document.getElementById('cert-date').innerText = dateStr;
        document.getElementById('cert-actual-date').innerText = dateStr;
        
        // Generate Unique ID
        const certID = "DOTR-HRDD-" + Math.floor(100000 + Math.random() * 900000);
        document.getElementById('cert-id-display').innerText = "Certificate ID: " + certID;
        
        // QR Code
        document.getElementById('qrcode').innerHTML = "";
        new QRCode(document.getElementById("qrcode"), {
            text: `ID: ${certID}\nName: ${userData.name}\nCourse: Digitalization & Well-Being\nDate: ${dateStr}`,
            width: 80,
            height: 80
        });

        // Show canvas momentarily to capture
        document.getElementById('certificate-preview').style.display = 'block';
    }

    function generateCertificate() {
        const certElement = document.getElementById('certificate-preview');
        
        html2canvas(certElement, { scale: 2 }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jspdf.jsPDF('l', 'mm', 'a4'); // Landscape
            const width = pdf.internal.pageSize.getWidth();
            const height = pdf.internal.pageSize.getHeight();
            
            pdf.addImage(imgData, 'PNG', 10, 10, width-20, height-20);
            pdf.save(`Certificate_${userData.name}.pdf`);
        });
    }

    // --- ADMIN ---
    function showAdminLogin() {
        document.getElementById('admin-modal').style.display = 'block';
    }

    function checkAdmin() {
        const pass = document.getElementById('admin-pass').value;
        if(pass === 'hrdd2O26') { // Note: prompt said O (Capital o) not 0
            document.getElementById('admin-modal').style.display = 'none';
            nextSection('section-admin');
            loadAdminData();
        } else {
            alert("Incorrect Password");
        }
    }

    function loadAdminData() {
        const tbody = document.getElementById('admin-table-body');
        tbody.innerHTML = "<tr><td colspan='4'>Loading from Firebase...</td></tr>";
        
        db.collection('attendance').get().then((querySnapshot) => {
            tbody.innerHTML = "";
            querySnapshot.forEach((doc) => {
                const d = doc.data();
                tbody.innerHTML += `
                    <tr>
                        <td>${d.name}</td>
                        <td>${d.position}</td>
                        <td>${d.office}</td>
                        <td>${d.mobile}</td>
                    </tr>
                `;
            });
        }).catch(err => {
            tbody.innerHTML = "<tr><td colspan='4'>Error loading data (Check console/permissions)</td></tr>";
        });
    }

</script>
</body>
</html>